{% extends "principal/base.html" %}
{% load static %}

{% block title %}M√©todos de pago - DVOLVE{% endblock %}

{% block extra_head %}
<style>
  /* tus estilos previos, con peque√±os ajustes para moneda */
  .pm-wrapper { min-height: calc(100vh - 160px); display:flex; align-items:center; justify-content:center; padding:40px 0; }
  .pm-card { width:100%; max-width:540px; background:#fff8f0; border:3px solid #c875ac; border-radius:12px; padding:22px; color:#5a4630; box-shadow:0 12px 30px rgba(2,6,23,0.06); }
  .pm-card h1 { font-size:1.4rem; margin-bottom:8px; }
  .pm-card p { color:#5a4630; margin-bottom:12px; }
  .monto-ars { font-weight:700; color:#7e2864; }
  .monto-usd { color:#6c6c6c; font-size:0.95rem; margin-left:8px; }
  .pm-btn { width:100%; display:block; padding:12px 14px; border-radius:10px; background:linear-gradient(45deg,#c875ac,#7e2864); color:#fff; text-decoration:none; text-align:center; margin-bottom:10px; }
  .pm-note { font-size:.9rem; color:#94a3b8; margin-top:8px; }
  .pm-back { margin-top:14px; text-align:center; }
  @media (max-width:576px){ .pm-card{ padding:18px;} }
</style>
{% endblock %}

{% block content %}
<section class="pm-wrapper">
  <div class="pm-card">
    <h1>Seleccion√° un m√©todo de pago</h1>

    <p>
      Vas a abonar
      <span class="monto-ars">${{ monto_ars|floatformat:0 }}</span>
      <span class="monto-usd">(USD {{ monto_usd }})</span>.
      Ser√°s redirigido a la plataforma correspondiente para completar tu compra.
    </p>

    <div class="d-grid gap-2">
      <a role="button" class="pm-btn" id="mp-btn"
         data-href="{% url 'principal:pagar_mercadopago' %}?amount={{ monto_ars|urlencode }}&currency=ARS">
        Mercado Pago ‚Äî Pagar en ARS
      </a>

      <a role="button" class="pm-btn" id="pp-btn"
         data-href="{% url 'principal:pagar_paypal' %}?amount={{ monto_usd|urlencode }}&currency=USD">
        PayPal ‚Äî Pagar en USD
      </a>
    </div>

    <div class="pm-note">
      Si necesit√°s otra forma de pago contactanos por <a
      href="https://mail.google.com/mail/?view=cm&fs=1&to=dvolveprogram@gmail.com&su=Consulta&body=Hola%20Lula,%20me%20contactaba%20por..."
      target="_blank"
      class="contact-link"
    >
      Contacto
    </a>
    </div>
    

  </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
  (function(){
    const buttons = document.querySelectorAll('.pm-btn[data-href]');
    
    function enableButtons() {
      buttons.forEach(btn => {
        btn.disabled = false;
        if (btn.textContent.trim() === 'Redirigiendo‚Ä¶') {
          // Restaurar texto original seg√∫n el bot√≥n
          if (btn.id === 'mp-btn') btn.textContent = 'Mercado Pago ‚Äî Pagar en ARS';
          if (btn.id === 'pp-btn') btn.textContent = 'PayPal ‚Äî Pagar en USD';
        }
      });
    }

    // üîÅ Cada vez que la p√°gina se muestra (incluso al volver con el bot√≥n atr√°s)
    window.addEventListener('pageshow', enableButtons);

    // üöÄ L√≥gica de redirecci√≥n
    buttons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        if (btn.disabled) return;
        btn.disabled = true;
        btn.textContent = 'Redirigiendo‚Ä¶';
        const href = btn.getAttribute('data-href') || btn.href;
        if (!href) { btn.disabled = false; enableButtons(); return; }
        window.location.href = href;
      });
    });
  })();
</script>
{% endblock %}
